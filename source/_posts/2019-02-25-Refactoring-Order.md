---
layout: post
title: "리팩토링의 순서"
categories: Dev
tags: Dev
date: 2019-02-25
---

회사에서 맡게 된 두 가지 프로젝트가 있다.

하나는 잘못된 기술 스택과 당시의 악조건으로 인해 객관적(?)으로 심폐소생술이 어려워 새롭게 만들어야 한다.

나머지 하나는 React로 만들어져있고, 새롭게 만들 필요까지는 없으나 프로젝트 전체적으로 리팩토링을 해야 한다.

Redux로 되어있는 프로젝트이다.
하지만 오직 App component 하나에만 connect가 되어있고, 메서드의 다수는 데이터가 아닌 DOM의 className 등을 기반으로 조건처리가 되어있고, Page에 해당하는 component들은 1200 ~ 1500라인 정도 된다.
(React, Redux를 해본 사람들이라면 대략적으로 어떤 상태인지 짐작할 수 있으리라.)

머릿속에 떠오른 수많은 개선 아이디어들이 있었다. (아래는 그중 일부 예시이다.)

- Desktop과 Mobile로 나뉘어져있는 component의 공통점을 추출해서 중복을 없애고 같은 것들을 한 곳에서 처리하도록 한다
- render method의 대부분이 html tag 그대로 기재되어있는 것들을 최대한 presentor로 분리해낸다
- 프로젝트 전반에 대한 도메인을 파악한다 [https://adhrinae.github.io/posts/ui-as-an-afterthought-kr](https://adhrinae.github.io/posts/ui-as-an-afterthought-kr)
- 현재 너무나 많은 props를 주입받고 있고, 그것들에 대해 제대로 된 관리가 되어있지 않으므로 prop-types를 도입한다
- API 문서가 부족한 부분에 대해 TypeScript를 통해 타이핑을 한다
- Redux-saga를 도입해서 가독성을 높인다
- Ducks 패턴을 도입해서 action types, action creators, reducer와 같이 레이어 단위로 나뉘어져있는 파일들을 도메인을 기준으로 나눈다
- redux-batch 등을 활용해서 특정 action에서 dispatch가 여러 번 이루어지는 것을 방지한다
- hooks를 사용해서 보다 간결한 component를 만든다
- antd를 도입해서 전형적인 component들을 대체한다
- ...

당연하게도(?) 테스트 코드는 없기 때문에, 기존 프로젝트가 깨지지 않는다는 것을 쉽게 확인할 수 있어야만 덜 걱정하며 배포할 수 있을 것이다.

그런 측면에서 점진적으로 개선시켜나가는 것은 대단히 중요하고, 어떠한 작업을 하든 의식적으로 대단히 작은 단위로 나누어 작업하면서 계속해서 확인하고, 그것을 commit으로 나누어 기록해야만 한다는 점은 이러한 작업의 대원칙일 것이다.

그 다음으로 고민했던 지점은 저 수많은 개선점들을 어떠한 순서로 행할 것인가였다.

처음에는 각각의 개선점이 가져다 줄 생산성과 그것을 위한 역생산성(비용)을 따져보려고 했었다. (역생산성과 관련하여 Redux와 TypeScript를 선호하지 않는데, 관련된 내용은 나중에 조금 더 경험이 쌓인 뒤에 작성해보려고 한다.)
또는 비용과 난이도가 낮은 것부터 해봐야겠다고 생각도 했었다.

하지만 특정 지점에 대해서 프로젝트 전체를 개선시키고 그 작업이 끝나면 다음 개선지점을 프로젝트에 적용하는 방식으로 진행하기에는 상황적으로 무리가 있다고 판단하였다.

그렇다면 주어지는 테스크를 수행해나가면서 그것과 관련된 부분에 대해서만이라도 [보이 스카웃 규칙](https://johngrib.github.io/wiki/Boy-Scout-Rule/)을 적용하는 수 밖에 없지 않은가.

그랬을 때 무엇부터 적용할지에 대해서 다시 고민해보고 내린 결론은 다음과 같았다.
(함수형에서 대표적으로 쓰이는 컬렉션 함수들을 예시로 들겠다.)

0. Filter
- 기존 코드에서 쓰이지 않는 것들을 없애는 것을 최우선으로 한다. (이런 것들이 생긴 것은 아마도 [YAGNI](https://zetawiki.com/wiki/YAGNI) 때문일 것이다.) 왜냐하면 적용했을 때의 사이드이펙트도 가장 적을 것이고, 수행하는 것에 있어서도 가장 쉬울 것이기 때문이다.

1. Reduce
- 기존에 중복되어있거나 장황하게 되어있던 부분을 추상화한다. 이때의 접근방식은 기존 것을 유지한 상태로, 기존 것과 동일하다고 믿어지는(?) 추상물을 만들어서 교체해보았을 때 같은 결과가 나오면 그제서야 기존 것을 제거한다.

2. Map
- 기존 것과 같은 기능을 다르게 수행하는 것을 만든다. 비동기와 관련된 로직은 Saga가 아닌 Thunk로도 가능하다. 들어가는 비용은 적지 않은데 결과는 같으니, 내 스스로는 가독성이나 생산성이 개선된다고 생각하더라도 어느 지점에선 만족감만을 위한 작업일 가능성도 높으니 가장 후순위로 미룬다.

현재는 고민을 끝낸지 얼마 되지 않았고, 그동안 리팩토링 등과 관련한 책들을 구매만 해두고 읽어보지 못해서 이론과 경험을 쌓아가며 더 나은 방법론을 만들어가려고 한다.

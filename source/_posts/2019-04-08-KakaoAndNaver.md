---
layout: post
title: "카카오와 네이버를 통한 소셜 로그인"
categories: Dev
tags: Dev
date: 2019-04-08
---

2월 말부터 정말 지독한 슬럼프? 번아웃?에 시달려왔다. 부디 이번에 작업했던 결과물들을 회고하는 과정을 통해 탈출할 수 있기를 바라는 마음으로 미뤄왔던 회고글을 작성해본다. 업무상 다급하게 진행했던 과정들이었기에 기재한 내용들에 대해 엄밀한 검증을 거치지 못하고 느낌만으로 작성하는 글이다.

---

스프린트라고 말하기엔 민망한 긴 기간동안 소셜 로그인 기능을 추가하는 작업을 진행했다.

여러 Provider가 존재하겠지만, 이번에 진행했던 것은 카카오와 네이버를 통한 회원가입 및 로그인이었다.

카카오와 네이버는 기본적으로 SDK를 제공해주지만 둘은 여러 가지 측면에서 차이가 존재한다.

0. 신고제 VS 허가제
    카카오는 신고제 느낌인데 비해 네아로(= 네이버 아이디로 로그인, 네이버 문서에도 나오는 명칭)는 개발 후에 검수를 거쳐서 심사를 통과해야만 사용할 수 있다.
1. Service URL, Callback URL
   SDK를 통해 로그인 관련 정보를 Service URL과 Callback URL를 합친 주소로 받아오기 마련이다. 카카오는 Callback URL이 하나인 대신에 Service URL을 여러 개 사용할 수 있고, 네이버는 반대로 Service URL 하나와 여러 Callback URL을 사용할 수 있다. 실제로 구현해보면 카카오가 훨씬 더 편하다는 점을 알 수 있다. 로컬호스트로 개발할 때, 스테이징 서버를 배포했을 때, 프로덕션에 배포했을 때 모두를 지원할 수 있기 때문이다. 그에 비해서 네이버는 검수 요청을 하려면 기본적으로 배포를 해야 하고, 그렇게 되면 로컬호스트로는 이용할 수 없는 상태가 되어버린다. (또는 프로덕션에 배포했을 때도 마찬가지이다.) 네이버 + 로컬호스트 관련해서 몇 시간 정도 시행착오를 겪었던 지점이 있는데, Service URL을 반드시 `http://localhost:3000` 로 작성해야 기대한 방향대로 동작할 것이다. 설정하는 페이지에는 `서비스 URL: 실제 서비스하는 사이트 URL과 동일한지 확인 (www, 포트번호, http/https 구분 없이 도메인명만 정확히 입력)` 라고 나와있지만 실제로는 뒤에 포트도 기재되어야 한다.
2. SDK
   네아로가 상대적으로 더 오래된 기능이어서 그런지, API와 문서화 모두 카카오만 기대에 부응하는 편이다. 네아로 관련 문서에서 튜토리얼은 2.0을 기준으로 설명하고 있는데, API 명세는 1.03을 기준으로 설명되어있다. 그 다음에 굳이 매번 API 사용 전에 반복적으로 new로 인스턴스를 생성하고 init method를 통해 초기화를 해주어야 하며, 로그인 버튼을 활용한 콜백 패턴 외에는 달리 Access Token을 받아올 방법을 찾을 수 없었다. 네이버/카카오를 통한 회원가입 뿐만 아니라  이미 가입된 계정에서의 연동도 지원해주어야 했는데, 네이버는 어쩔 수 없이 SDK에서 제공해주는 로그인 버튼을 숨겨두었다가 연동 설정 요청이 들어오면 숨겨둔 버튼을 클릭하여 redirect path에서 Access Token을 받아서 우리측 API에 보내주어야만 했다. 카카오는 초기화를 한 번만 해주면 되며, 연동의 경우에도 Kakao.Auth.login으로 바로 구현이 가능하다.
3. Flow
   로그인 관련 정보를 받아오는 플로우에 있어서 차이가 존재한다. 네이버는 SDK를 통해 정보를 받아오면서 redirect path로 보내지지만, 카카오는 redirect path로 이동한 뒤에 요청해서 받아오는 플로우라고 기억한다. SocialSignupPage라는 Component 하나로 둘 모두 지원해주려고 했기 때문에 카카오는 SDK에서 제공해주는 로그인 버튼을 사용하지 않고, 카카오로 로그인 이라는 버튼을 클릭하면 redirect path로 직접 보낸 뒤 /naver 와 /kakao 중 kakao일 경우 SDK에서 제공해주는 함수(Kakao.Auth.login)를 이용하여 직접 Access Token을 받아오도록 하였다. (네이버는 플로우를 달리 커스텀할 수 있는 방법이 보이지 않았다.)
4. Mobile
   카카오는 모두 쉽다고 생각했었지만 모바일에서 문제가 한 번 있었다. 데스크탑이라면 카카오 로그인을 끝내고  로그인 창이 꺼지고 Access Token을 알아서 받아오는 과정이 진행될텐데 모바일에서는 빈 탭이 띄워져있는 상태에서 멈춰져있고 Access Token도 받아와지지 않았다. 카카오 측에서 제공해주는 데모 페이지에서는 일어나지 않는 현상이고, 그곳에 있는 코드와 큰 차이가 없어서 원인을 파악하는데 시간을 많이 소모하였다. 결론적으로는 throughTalk라는 옵션을 false로 처리하면 해결이 된다. 이 옵션은 default: true인데 이때는 스키마를 통해 카카오톡을 불러오는 과정에서 뭔가 문제가 있어서 멈췄던 것으로 추측하고 있다. (운영체제가 업데이트되어서 관련 로직이 바뀌었는데 아직 대응이 안 되었다든지 등)

이상이 현재 기억나는 카카오와 네이버 관련해서 겪었던 이슈들이다. 다음 글에서는 위 기능을 구현하는 과정에서 리팩토링을 하기 위해 어떤 구조를 택하게 되었고 TypeScript를 일부 도입하는 등 프로젝트와 관련된 내용들을 기술해보려고 한다.
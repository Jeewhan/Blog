---
layout: post
title: "Async"
categories: JS
tags: JS
date: 2018-12-10
---

## Async (= 비동기)

Async란 무엇인가? Sub routine이 callback을 통해 값을 반환하는 것이다



### Promise, async/await

Async 연산을 다루는 객체이며, 값이 되기로 약속된 값이다

기존에는 Async를 콜백 패턴을 통해 결과가 실행되기 위한 조건과 그에 따른 핸들러 함수를 넘겨주는 방식이었다

하지만 이렇게 되면 Async끼리 순서상 의존성을 가질 경우 아래와 같은 그림이 될 수 밖에 없었다

![img](https://cdn-images-1.medium.com/max/823/1*Co0gr64Uo5kSg89ukFD2dw.jpeg)

Promise는 위의 callback hell을 개선하는 것이 목표는 아니지만, 결과적으로 가독성의 향상을 가져오는 것도 사실이다

하지만 Promise가 보다 의미있는 지점들이 더 있다

기존의 콜백 패턴의 경우 이벤트 핸들러가 언제 호출될지 정말로 알 수 없으며, 이벤트 발생 시점이 곧 호출시점으로 이어지기 때문에 개발자가 Flow에 대해 조절할 수 있는 부분이 없다

그러나 Promise는 그렇지 않다, Promise를 선언해놓으면 then을 하지 않더라도 call stack이 비워진 시점에 수행될 것이고, 후에 then을 하게 되면 resolve 여부에 따라 바로 수행되거나 resolve가 될 때까지 기다리게 될 것이다 (Pending -> Fulfilled)

이러한 지점은 Promise에 대한 제대로 된 이해없이 async/await으로 곧장 넘어가게 되면 쉽게 간과할 수 있는 부분들이다, 비동기를 기다리기 위해서 무조건적으로 await을 사용할 것이 아니라 먼저 then 없이 선언하는 것을 통해 작업이 수행되도록 하고, 해당 비동기 로직과 의존성이 없는 작업들을 먼저 수행하고, 의존성이 발생한 지점에는 then이든 await이든 활용하여 기다린 후 해당 작업이 수행되도록 하는 것이 훨씬 좋은 전략이라고 생각된다

왜냐하면 브라우저의 렌더링도 다른 자바스크립트 로직들과 함께 싱글 스레드의 call stack을 통해 처리될 것이므로 이러한 유연성을 갖출 수 있다는 것은 보다 유려한 UI/UX를 만들 수 있도록 해줄 것이기 때문이다

그렇게 했을 때만 비동기라는 이름에 걸맞게, 왼쪽이 아닌 오른쪽과 같이 처리할 수 있다

![img](http://www.nextree.co.kr/content/images/2016/09/syhan_140320_node1_031-1024x369.png)

또한 async는 Promise로 래핑된 값을 반환한다 (return 값은 then을 통해 넘겨받을 수 있다), 따라서 new Promise 또는 Promise.resolve() 외에도 async function를 통해서도 Promise를 만들어낼 수 있다

await은 다음에 나오는 문의 값이 Promise라면 fulfill된 값, 그렇지 않다면 해당 값을 `resolved Promise`로 변환시킨다



async/await을 사용했을 때 유용한 케이스는 resolved value를 변수에 담고자 할 때, 에러 처리, 조건문, 디버깅 등이다 ([자바스크립트는 어떻게 작동하는가: 이벤트 루프와 비동기 프로그래밍의 부상, async/await을 이용한 코딩 팁 다섯 가지](https://engineering.huiseoul.com/자바스크립트는-어떻게-작동하는가-이벤트-루프와-비동기-프로그래밍의-부상-async-await을-이용한-코딩-팁-다섯-가지-df65ffb4e7e))



여러 Promise들이 모두 완료되길 기다려야 한다면 [Promise.all()](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)를, 타임아웃과 같은 처리를 하고 싶다면 [Promise.race()](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/race)를 활용하면 된다



### Reference

- [States and Fates](https://github.com/domenic/promises-unwrapping/blob/master/docs/states-and-fates.md)
- [Using promises](https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Using_promises)
- [Promise](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise)
- [async function](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/async_function)
- [await](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/await)
- [async/await 를 사용하기 전에 promise를 이해하기](https://medium.com/@kiwanjung/번역-async-await-를-사용하기-전에-promise를-이해하기-955dbac2c4a4)
- [자바스크립트 개념잡기: 콜백 함수의 동기적 실행과 비동기적 실행](https://www.youtube.com/watch?v=j0Viy3v97gY)
- [자바스크립트 promise? 나도 써보자, 기본 개념부터~](https://www.youtube.com/watch?v=CA5EDD4Hjz4)
- [자바스크립트 async / await? 나도 써보자, 기본 개념부터~](https://www.youtube.com/watch?v=JzXjB6L99N4)
- [Callback이 뭐죠?](https://medium.com/@nemo1275/callback이-뭐죠-5f3c0cc4efce)
- [Promise가 뭐죠?](https://medium.com/@nemo1275/promise가-뭐죠-fdf7de2bc0bf)
- [await가 뭐죠?](https://medium.com/@nemo1275/await가-뭐죠-1332622df251)
- [자바스크립트 비동기 처리와 콜백 함수](https://joshua1988.github.io/web-development/javascript/javascript-asynchronous-operation/)
- [자바스크립트 Promise 쉽게 이해하기](https://joshua1988.github.io/web-development/javascript/promise-for-beginners/)
- [Master the JavaScript Interview: What is a Promise?](https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-promise-27fc71e77261)
- [콜백 함수(Callback)의 정확한 의미는 무엇일까?](http://satisfactoryplace.tistory.com/18)
- [Callback](http://www.ktword.co.kr/abbr_view.php?m_temp1=3581)